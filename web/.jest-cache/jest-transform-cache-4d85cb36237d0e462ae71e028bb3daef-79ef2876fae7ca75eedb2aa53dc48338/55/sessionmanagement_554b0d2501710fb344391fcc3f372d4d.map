{"version":3,"sources":["/Users/matthewmoroney/builds/FreeAgentics/web/lib/session-management.ts"],"sourcesContent":["import { isBrowser } from \"./browser-check\";\n\nexport function getSessionId(provider: string): string | null {\n  if (!isBrowser) {\n    console.log(\"getSessionId called on server, returning null\");\n    return null;\n  }\n\n  try {\n    const sessionId = localStorage.getItem(`api_session_${provider}`);\n    console.log(`Retrieved session ID for provider ${provider}:`, sessionId);\n    return sessionId;\n  } catch (error) {\n    console.error(\"Error getting session ID:\", error);\n    return null;\n  }\n}\n\nexport function setSessionId(provider: string, sessionId: string): void {\n  if (!isBrowser) {\n    console.log(\"setSessionId called on server, skipping\");\n    return;\n  }\n\n  try {\n    localStorage.setItem(`api_session_${provider}`, sessionId);\n    console.log(`Stored session ID for provider ${provider}:`, sessionId);\n  } catch (error) {\n    console.error(\"Error setting session ID:\", error);\n  }\n}\n\nexport function clearSessionId(provider: string): void {\n  if (!isBrowser) {\n    console.log(\"clearSessionId called on server, skipping\");\n    return;\n  }\n\n  try {\n    localStorage.removeItem(`api_session_${provider}`);\n    console.log(`Cleared session ID for provider ${provider}`);\n  } catch (error) {\n    console.error(\"Error clearing session ID:\", error);\n  }\n}\n\nexport function storeSessionId(provider: string, sessionId: string): void {\n  if (!isBrowser) {\n    console.log(\"storeSessionId called on server, skipping\");\n    return;\n  }\n\n  try {\n    localStorage.setItem(`api_session_${provider}`, sessionId);\n    console.log(`Stored session ID for provider ${provider}:`, sessionId);\n  } catch (error) {\n    console.error(\"Error storing session ID:\", error);\n  }\n}\n\nexport async function getApiKeyFromSession(\n  provider: string,\n): Promise<string | null> {\n  try {\n    const sessionId = getSessionId(provider);\n    if (!sessionId) return null;\n\n    const response = await fetch(\"/api/api-key/retrieve\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ provider, sessionId }),\n    });\n\n    if (!response.ok) return null;\n    const data = await response.json();\n    return data.apiKey;\n  } catch (error) {\n    console.error(\"Error retrieving API key:\", error);\n    return null;\n  }\n}\n\nexport function validateStoredSession(\n  provider: string,\n  sessionId: string,\n): boolean {\n  const storedSessionId = getSessionId(provider);\n  return storedSessionId === sessionId;\n}\n"],"names":["clearSessionId","getApiKeyFromSession","getSessionId","setSessionId","storeSessionId","validateStoredSession","provider","isBrowser","console","log","sessionId","localStorage","getItem","error","setItem","removeItem","response","fetch","method","headers","body","JSON","stringify","ok","data","json","apiKey","storedSessionId"],"mappings":";;;;;;;;;;;IAgCgBA,cAAc;eAAdA;;IA4BMC,oBAAoB;eAApBA;;IA1DNC,YAAY;eAAZA;;IAgBAC,YAAY;eAAZA;;IA4BAC,cAAc;eAAdA;;IAoCAC,qBAAqB;eAArBA;;;8BAlFU;AAEnB,SAASH,aAAaI,QAAgB;IAC3C,IAAI,CAACC,uBAAS,EAAE;QACdC,QAAQC,GAAG,CAAC;QACZ,OAAO;IACT;IAEA,IAAI;QACF,MAAMC,YAAYC,aAAaC,OAAO,CAAC,CAAC,YAAY,EAAEN,SAAS,CAAC;QAChEE,QAAQC,GAAG,CAAC,CAAC,kCAAkC,EAAEH,SAAS,CAAC,CAAC,EAAEI;QAC9D,OAAOA;IACT,EAAE,OAAOG,OAAO;QACdL,QAAQK,KAAK,CAAC,6BAA6BA;QAC3C,OAAO;IACT;AACF;AAEO,SAASV,aAAaG,QAAgB,EAAEI,SAAiB;IAC9D,IAAI,CAACH,uBAAS,EAAE;QACdC,QAAQC,GAAG,CAAC;QACZ;IACF;IAEA,IAAI;QACFE,aAAaG,OAAO,CAAC,CAAC,YAAY,EAAER,SAAS,CAAC,EAAEI;QAChDF,QAAQC,GAAG,CAAC,CAAC,+BAA+B,EAAEH,SAAS,CAAC,CAAC,EAAEI;IAC7D,EAAE,OAAOG,OAAO;QACdL,QAAQK,KAAK,CAAC,6BAA6BA;IAC7C;AACF;AAEO,SAASb,eAAeM,QAAgB;IAC7C,IAAI,CAACC,uBAAS,EAAE;QACdC,QAAQC,GAAG,CAAC;QACZ;IACF;IAEA,IAAI;QACFE,aAAaI,UAAU,CAAC,CAAC,YAAY,EAAET,SAAS,CAAC;QACjDE,QAAQC,GAAG,CAAC,CAAC,gCAAgC,EAAEH,SAAS,CAAC;IAC3D,EAAE,OAAOO,OAAO;QACdL,QAAQK,KAAK,CAAC,8BAA8BA;IAC9C;AACF;AAEO,SAAST,eAAeE,QAAgB,EAAEI,SAAiB;IAChE,IAAI,CAACH,uBAAS,EAAE;QACdC,QAAQC,GAAG,CAAC;QACZ;IACF;IAEA,IAAI;QACFE,aAAaG,OAAO,CAAC,CAAC,YAAY,EAAER,SAAS,CAAC,EAAEI;QAChDF,QAAQC,GAAG,CAAC,CAAC,+BAA+B,EAAEH,SAAS,CAAC,CAAC,EAAEI;IAC7D,EAAE,OAAOG,OAAO;QACdL,QAAQK,KAAK,CAAC,6BAA6BA;IAC7C;AACF;AAEO,eAAeZ,qBACpBK,QAAgB;IAEhB,IAAI;QACF,MAAMI,YAAYR,aAAaI;QAC/B,IAAI,CAACI,WAAW,OAAO;QAEvB,MAAMM,WAAW,MAAMC,MAAM,yBAAyB;YACpDC,QAAQ;YACRC,SAAS;gBAAE,gBAAgB;YAAmB;YAC9CC,MAAMC,KAAKC,SAAS,CAAC;gBAAEhB;gBAAUI;YAAU;QAC7C;QAEA,IAAI,CAACM,SAASO,EAAE,EAAE,OAAO;QACzB,MAAMC,OAAO,MAAMR,SAASS,IAAI;QAChC,OAAOD,KAAKE,MAAM;IACpB,EAAE,OAAOb,OAAO;QACdL,QAAQK,KAAK,CAAC,6BAA6BA;QAC3C,OAAO;IACT;AACF;AAEO,SAASR,sBACdC,QAAgB,EAChBI,SAAiB;IAEjB,MAAMiB,kBAAkBzB,aAAaI;IACrC,OAAOqB,oBAAoBjB;AAC7B"}