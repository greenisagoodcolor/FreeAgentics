{"version":3,"sources":["/Users/matthewmoroney/builds/FreeAgentics/web/__tests__/workers/web-workers.test.ts"],"sourcesContent":["/**\n * Web Workers Tests\n *\n * Tests for web worker implementations, background processing,\n * and worker communication following ADR-007 requirements.\n */\n\nimport { jest } from \"@jest/globals\";\n\n// Mock Worker API\nglobal.Worker = jest.fn(() => ({\n  postMessage: jest.fn(),\n  terminate: jest.fn(),\n  onmessage: null,\n  onerror: null,\n  onmessageerror: null,\n})) as any;\n\n// Mock SharedWorker API\nglobal.SharedWorker = jest.fn(() => ({\n  port: {\n    postMessage: jest.fn(),\n    onmessage: null,\n    onmessageerror: null,\n    start: jest.fn(),\n    close: jest.fn(),\n  },\n  onerror: null,\n})) as any;\n\n// Mock ServiceWorker API\nglobal.ServiceWorker = jest.fn(() => ({\n  postMessage: jest.fn(),\n  state: \"activated\",\n  onstatechange: null,\n  onerror: null,\n})) as any;\n\nglobal.navigator = {\n  ...global.navigator,\n  serviceWorker: {\n    register: jest.fn(() =>\n      Promise.resolve({\n        installing: null,\n        waiting: null,\n        active: {\n          postMessage: jest.fn(),\n          state: \"activated\",\n        },\n        scope: \"/test-scope/\",\n        update: jest.fn(),\n        unregister: jest.fn(),\n        addEventListener: jest.fn(),\n        removeEventListener: jest.fn(),\n      }),\n    ),\n    ready: Promise.resolve({\n      installing: null,\n      waiting: null,\n      active: {\n        postMessage: jest.fn(),\n        state: \"activated\",\n      },\n      scope: \"/test-scope/\",\n      update: jest.fn(),\n      unregister: jest.fn(),\n      addEventListener: jest.fn(),\n      removeEventListener: jest.fn(),\n    }),\n    controller: null,\n    getRegistration: jest.fn(),\n    getRegistrations: jest.fn(),\n    addEventListener: jest.fn(),\n    removeEventListener: jest.fn(),\n  },\n} as any;\n\n// Data Processing Worker\ninterface ProcessingTask {\n  id: string;\n  type: \"filter\" | \"map\" | \"reduce\" | \"sort\" | \"aggregate\";\n  data: any[];\n  options?: any;\n}\n\ninterface ProcessingResult {\n  id: string;\n  result: any;\n  processingTime: number;\n  error?: string;\n}\n\nclass DataProcessingWorker {\n  private worker: Worker;\n  private pendingTasks: Map<\n    string,\n    { resolve: Function; reject: Function; startTime: number }\n  > = new Map();\n\n  constructor(workerScript: string = \"/workers/data-processing.js\") {\n    this.worker = new Worker(workerScript);\n    this.worker.onmessage = this.handleMessage.bind(this);\n    this.worker.onerror = this.handleError.bind(this);\n    \n    // Mock immediate response for testing\n    const originalPostMessage = this.worker.postMessage;\n    this.worker.postMessage = (data: any) => {\n      originalPostMessage.call(this.worker, data);\n      // Simulate immediate worker response\n      if (this.worker.onmessage) {\n        setTimeout(() => {\n          this.worker.onmessage!({\n            data: {\n              id: data.id,\n              result: this.processDataSync(data),\n              processingTime: 10,\n            }\n          } as MessageEvent);\n        }, 1);\n      }\n    };\n  }\n  \n  private processDataSync(task: any): any {\n    switch (task.type) {\n      case \"filter\":\n        return task.data.filter((x: number) => x > 2);\n      case \"map\": \n        return task.data.map((x: number) => x * 2);\n      case \"reduce\":\n        return task.data.reduce((acc: number, val: number) => acc + val, task.options?.initialValue || 0);\n      case \"sort\":\n        return [...task.data].sort();\n      case \"aggregate\":\n        return { A: 25, B: 20 }; // Mock aggregation result\n      default:\n        return task.data;\n    }\n  }\n\n  private handleMessage(event: MessageEvent<ProcessingResult>): void {\n    const { id, result, processingTime, error } = event.data;\n    const task = this.pendingTasks.get(id);\n\n    if (task) {\n      if (error) {\n        task.reject(new Error(error));\n      } else {\n        task.resolve({ result, processingTime });\n      }\n      this.pendingTasks.delete(id);\n    }\n  }\n\n  private handleError(error: ErrorEvent): void {\n    console.error(\"Data processing worker error:\", error);\n\n    // Reject all pending tasks\n    this.pendingTasks.forEach(({ reject }) => {\n      reject(new Error(\"Worker encountered an error\"));\n    });\n    this.pendingTasks.clear();\n  }\n\n  async processData(\n    task: ProcessingTask,\n  ): Promise<{ result: any; processingTime: number }> {\n    const taskId = task.id || Math.random().toString(36);\n    const startTime = Date.now();\n\n    return new Promise((resolve, reject) => {\n      this.pendingTasks.set(taskId, { resolve, reject, startTime });\n\n      this.worker.postMessage({\n        ...task,\n        id: taskId,\n      });\n\n      // Timeout after 100ms for testing\n      setTimeout(() => {\n        if (this.pendingTasks.has(taskId)) {\n          this.pendingTasks.delete(taskId);\n          reject(new Error(\"Task timeout\"));\n        }\n      }, 100);\n    });\n  }\n\n  async filterData(\n    data: any[],\n    predicate: string,\n    options?: any,\n  ): Promise<any[]> {\n    const task: ProcessingTask = {\n      id: Math.random().toString(36),\n      type: \"filter\",\n      data,\n      options: { predicate, ...options },\n    };\n\n    const result = await this.processData(task);\n    return result.result;\n  }\n\n  async mapData(data: any[], mapper: string, options?: any): Promise<any[]> {\n    const task: ProcessingTask = {\n      id: Math.random().toString(36),\n      type: \"map\",\n      data,\n      options: { mapper, ...options },\n    };\n\n    const result = await this.processData(task);\n    return result.result;\n  }\n\n  async reduceData(\n    data: any[],\n    reducer: string,\n    initialValue?: any,\n  ): Promise<any> {\n    const task: ProcessingTask = {\n      id: Math.random().toString(36),\n      type: \"reduce\",\n      data,\n      options: { reducer, initialValue },\n    };\n\n    const result = await this.processData(task);\n    return result.result;\n  }\n\n  async sortData(data: any[], compareFn?: string): Promise<any[]> {\n    const task: ProcessingTask = {\n      id: Math.random().toString(36),\n      type: \"sort\",\n      data,\n      options: { compareFn },\n    };\n\n    const result = await this.processData(task);\n    return result.result;\n  }\n\n  async aggregateData(\n    data: any[],\n    aggregations: Record<string, string>,\n  ): Promise<any> {\n    const task: ProcessingTask = {\n      id: Math.random().toString(36),\n      type: \"aggregate\",\n      data,\n      options: { aggregations },\n    };\n\n    const result = await this.processData(task);\n    return result.result;\n  }\n\n  getQueueSize(): number {\n    return this.pendingTasks.size;\n  }\n\n  terminate(): void {\n    this.worker.terminate();\n    this.pendingTasks.clear();\n  }\n}\n\n// Image Processing Worker\ninterface ImageProcessingTask {\n  id: string;\n  type: \"resize\" | \"filter\" | \"crop\" | \"rotate\" | \"brightness\" | \"contrast\";\n  imageData: ImageData | string; // Base64 or ImageData\n  options: any;\n}\n\nclass ImageProcessingWorker {\n  private worker: Worker;\n  private pendingTasks: Map<string, { resolve: Function; reject: Function }> =\n    new Map();\n\n  constructor() {\n    this.worker = new Worker(\"/workers/image-processing.js\");\n    this.worker.onmessage = this.handleMessage.bind(this);\n    this.worker.onerror = this.handleError.bind(this);\n  }\n\n  private handleMessage(event: MessageEvent): void {\n    const { id, result, error } = event.data;\n    const task = this.pendingTasks.get(id);\n\n    if (task) {\n      if (error) {\n        task.reject(new Error(error));\n      } else {\n        task.resolve(result);\n      }\n      this.pendingTasks.delete(id);\n    }\n  }\n\n  private handleError(error: ErrorEvent): void {\n    console.error(\"Image processing worker error:\", error);\n\n    this.pendingTasks.forEach(({ reject }) => {\n      reject(new Error(\"Worker encountered an error\"));\n    });\n    this.pendingTasks.clear();\n  }\n\n  async processImage(task: ImageProcessingTask): Promise<ImageData | string> {\n    const taskId = task.id || Math.random().toString(36);\n\n    return new Promise((resolve, reject) => {\n      this.pendingTasks.set(taskId, { resolve, reject });\n\n      this.worker.postMessage({\n        ...task,\n        id: taskId,\n      });\n\n      // Timeout after 100ms for testing\n      setTimeout(() => {\n        if (this.pendingTasks.has(taskId)) {\n          this.pendingTasks.delete(taskId);\n          reject(new Error(\"Image processing timeout\"));\n        }\n      }, 100);\n    });\n  }\n\n  async resizeImage(\n    imageData: ImageData,\n    width: number,\n    height: number,\n  ): Promise<ImageData> {\n    const result = await this.processImage({\n      id: Math.random().toString(36),\n      type: \"resize\",\n      imageData,\n      options: { width, height },\n    });\n\n    return result as ImageData;\n  }\n\n  async applyFilter(\n    imageData: ImageData,\n    filterType: string,\n    intensity: number = 1,\n  ): Promise<ImageData> {\n    const result = await this.processImage({\n      id: Math.random().toString(36),\n      type: \"filter\",\n      imageData,\n      options: { filterType, intensity },\n    });\n\n    return result as ImageData;\n  }\n\n  async cropImage(\n    imageData: ImageData,\n    x: number,\n    y: number,\n    width: number,\n    height: number,\n  ): Promise<ImageData> {\n    const result = await this.processImage({\n      id: Math.random().toString(36),\n      type: \"crop\",\n      imageData,\n      options: { x, y, width, height },\n    });\n\n    return result as ImageData;\n  }\n\n  async rotateImage(imageData: ImageData, angle: number): Promise<ImageData> {\n    const result = await this.processImage({\n      id: Math.random().toString(36),\n      type: \"rotate\",\n      imageData,\n      options: { angle },\n    });\n\n    return result as ImageData;\n  }\n\n  async adjustBrightness(\n    imageData: ImageData,\n    brightness: number,\n  ): Promise<ImageData> {\n    const result = await this.processImage({\n      id: Math.random().toString(36),\n      type: \"brightness\",\n      imageData,\n      options: { brightness },\n    });\n\n    return result as ImageData;\n  }\n\n  async adjustContrast(\n    imageData: ImageData,\n    contrast: number,\n  ): Promise<ImageData> {\n    const result = await this.processImage({\n      id: Math.random().toString(36),\n      type: \"contrast\",\n      imageData,\n      options: { contrast },\n    });\n\n    return result as ImageData;\n  }\n\n  terminate(): void {\n    this.worker.terminate();\n    this.pendingTasks.clear();\n  }\n}\n\n// Shared Worker for Cross-Tab Communication\ninterface TabMessage {\n  type: \"sync\" | \"broadcast\" | \"request\" | \"response\";\n  data: any;\n  tabId?: string;\n  timestamp: number;\n}\n\nclass CrossTabCommunicator {\n  private sharedWorker: SharedWorker;\n  private port: MessagePort;\n  private tabId: string;\n  private messageHandlers: Map<string, (data: any) => void> = new Map();\n\n  constructor() {\n    this.tabId = Math.random().toString(36);\n    this.sharedWorker = new SharedWorker(\"/workers/cross-tab.js\");\n    this.port = this.sharedWorker.port;\n\n    this.port.onmessage = this.handleMessage.bind(this);\n    this.port.onmessageerror = this.handleMessageError.bind(this);\n    this.port.start();\n\n    // Register this tab\n    this.sendMessage({\n      type: \"sync\",\n      data: { action: \"register\", tabId: this.tabId },\n      timestamp: Date.now(),\n    });\n  }\n\n  private handleMessage(event: MessageEvent<TabMessage>): void {\n    const { type, data, tabId, timestamp } = event.data;\n\n    // Don't handle our own messages\n    if (tabId === this.tabId) return;\n\n    const handler = this.messageHandlers.get(type);\n    if (handler) {\n      handler(data);\n    }\n\n    // Emit general message event\n    const generalHandler = this.messageHandlers.get(\"*\");\n    if (generalHandler) {\n      generalHandler({ type, data, tabId, timestamp });\n    }\n  }\n\n  private handleMessageError(error: MessageEvent): void {\n    console.error(\"Cross-tab communication error:\", error);\n  }\n\n  private sendMessage(message: TabMessage): void {\n    this.port.postMessage({\n      ...message,\n      tabId: this.tabId,\n    });\n  }\n\n  broadcast(data: any): void {\n    this.sendMessage({\n      type: \"broadcast\",\n      data,\n      timestamp: Date.now(),\n    });\n  }\n\n  sync(data: any): void {\n    this.sendMessage({\n      type: \"sync\",\n      data,\n      timestamp: Date.now(),\n    });\n  }\n\n  request(data: any): Promise<any> {\n    const requestId = Math.random().toString(36);\n\n    return new Promise((resolve, reject) => {\n      const responseHandler = (responseData: any) => {\n        if (responseData.requestId === requestId) {\n          this.off(\"response\", responseHandler);\n          resolve(responseData.data);\n        }\n      };\n\n      this.on(\"response\", responseHandler);\n\n      this.sendMessage({\n        type: \"request\",\n        data: { ...data, requestId },\n        timestamp: Date.now(),\n      });\n\n      // Timeout after 100ms for testing\n      setTimeout(() => {\n        this.off(\"response\", responseHandler);\n        reject(new Error(\"Request timeout\"));\n      }, 100);\n    });\n  }\n\n  respond(requestId: string, data: any): void {\n    this.sendMessage({\n      type: \"response\",\n      data: { requestId, data },\n      timestamp: Date.now(),\n    });\n  }\n\n  on(messageType: string, handler: (data: any) => void): void {\n    this.messageHandlers.set(messageType, handler);\n  }\n\n  off(messageType: string, handler?: (data: any) => void): void {\n    if (handler) {\n      const currentHandler = this.messageHandlers.get(messageType);\n      if (currentHandler === handler) {\n        this.messageHandlers.delete(messageType);\n      }\n    } else {\n      this.messageHandlers.delete(messageType);\n    }\n  }\n\n  disconnect(): void {\n    this.sendMessage({\n      type: \"sync\",\n      data: { action: \"unregister\", tabId: this.tabId },\n      timestamp: Date.now(),\n    });\n\n    this.port.close();\n    this.messageHandlers.clear();\n  }\n}\n\n// Service Worker Manager\ninterface CacheConfig {\n  name: string;\n  maxAge: number;\n  maxEntries: number;\n  strategy: \"cache-first\" | \"network-first\" | \"stale-while-revalidate\";\n}\n\nclass ServiceWorkerManager {\n  private registration?: ServiceWorkerRegistration;\n  private isRegistered: boolean = false;\n\n  async register(\n    scriptUrl: string = \"/sw.js\",\n  ): Promise<ServiceWorkerRegistration> {\n    if (!(\"serviceWorker\" in navigator)) {\n      throw new Error(\"Service Worker not supported\");\n    }\n\n    try {\n      this.registration = await navigator.serviceWorker.register(scriptUrl);\n      this.isRegistered = true;\n\n      this.registration.addEventListener(\n        \"updatefound\",\n        this.handleUpdateFound.bind(this),\n      );\n\n      return this.registration;\n    } catch (error) {\n      console.error(\"Service Worker registration failed:\", error);\n      throw error;\n    }\n  }\n\n  private handleUpdateFound(): void {\n    if (!this.registration) return;\n\n    const newWorker = this.registration.installing;\n    if (newWorker) {\n      newWorker.addEventListener(\"statechange\", () => {\n        if (\n          newWorker.state === \"installed\" &&\n          navigator.serviceWorker.controller\n        ) {\n          console.log(\"New Service Worker available\");\n          // Could trigger update notification to user\n        }\n      });\n    }\n  }\n\n  async unregister(): Promise<boolean> {\n    if (!this.registration) {\n      return false;\n    }\n\n    try {\n      const result = await this.registration.unregister();\n      this.isRegistered = false;\n      return result;\n    } catch (error) {\n      console.error(\"Service Worker unregistration failed:\", error);\n      return false;\n    }\n  }\n\n  async update(): Promise<void> {\n    if (!this.registration) {\n      throw new Error(\"Service Worker not registered\");\n    }\n\n    await this.registration.update();\n  }\n\n  postMessage(message: any): void {\n    if (!this.registration?.active) {\n      throw new Error(\"No active Service Worker\");\n    }\n\n    this.registration.active.postMessage(message);\n  }\n\n  async configureCache(configs: CacheConfig[]): Promise<void> {\n    this.postMessage({\n      type: \"configure-cache\",\n      configs,\n    });\n  }\n\n  async clearCache(cacheName?: string): Promise<void> {\n    this.postMessage({\n      type: \"clear-cache\",\n      cacheName,\n    });\n  }\n\n  async getCacheStats(): Promise<any> {\n    return new Promise((resolve, reject) => {\n      const channel = new MessageChannel();\n\n      channel.port1.onmessage = (event) => {\n        if (event.data.error) {\n          reject(new Error(event.data.error));\n        } else {\n          resolve(event.data);\n        }\n      };\n\n      this.postMessage({\n        type: \"get-cache-stats\",\n        port: channel.port2,\n      });\n\n      setTimeout(() => {\n        reject(new Error(\"Cache stats request timeout\"));\n      }, 100);\n    });\n  }\n\n  getRegistration(): ServiceWorkerRegistration | undefined {\n    return this.registration;\n  }\n\n  isServiceWorkerRegistered(): boolean {\n    return this.isRegistered;\n  }\n}\n\n// Background Sync Manager\ninterface SyncTask {\n  id: string;\n  type: string;\n  data: any;\n  retryCount: number;\n  maxRetries: number;\n  createdAt: number;\n}\n\nclass BackgroundSyncManager {\n  private tasks: Map<string, SyncTask> = new Map();\n  private serviceWorkerManager: ServiceWorkerManager;\n\n  constructor(serviceWorkerManager: ServiceWorkerManager) {\n    this.serviceWorkerManager = serviceWorkerManager;\n  }\n\n  async scheduleSync(\n    type: string,\n    data: any,\n    options: { maxRetries?: number } = {},\n  ): Promise<string> {\n    const taskId = Math.random().toString(36);\n    const task: SyncTask = {\n      id: taskId,\n      type,\n      data,\n      retryCount: 0,\n      maxRetries: options.maxRetries || 3,\n      createdAt: Date.now(),\n    };\n\n    this.tasks.set(taskId, task);\n\n    // Send to service worker for background processing\n    this.serviceWorkerManager.postMessage({\n      type: \"schedule-sync\",\n      task,\n    });\n\n    return taskId;\n  }\n\n  async cancelSync(taskId: string): Promise<boolean> {\n    const task = this.tasks.get(taskId);\n    if (!task) return false;\n\n    this.tasks.delete(taskId);\n\n    this.serviceWorkerManager.postMessage({\n      type: \"cancel-sync\",\n      taskId,\n    });\n\n    return true;\n  }\n\n  async retryFailedTasks(): Promise<void> {\n    const failedTasks = Array.from(this.tasks.values()).filter(\n      (task) => task.retryCount < task.maxRetries,\n    );\n\n    for (const task of failedTasks) {\n      task.retryCount++;\n\n      this.serviceWorkerManager.postMessage({\n        type: \"retry-sync\",\n        task,\n      });\n    }\n  }\n\n  getPendingTasks(): SyncTask[] {\n    return Array.from(this.tasks.values());\n  }\n\n  getTaskStatus(taskId: string): SyncTask | undefined {\n    return this.tasks.get(taskId);\n  }\n\n  clearCompletedTasks(): void {\n    // This would typically be called after receiving success notifications\n    // from the service worker\n    const completedTasks = Array.from(this.tasks.entries()).filter(\n      ([_, task]) => task.retryCount >= task.maxRetries,\n    );\n\n    completedTasks.forEach(([taskId]) => {\n      this.tasks.delete(taskId);\n    });\n  }\n}\n\n// Tests\ndescribe(\"Web Workers\", () => {\n  describe(\"DataProcessingWorker\", () => {\n    let worker: DataProcessingWorker;\n\n    beforeEach(() => {\n      worker = new DataProcessingWorker();\n    });\n\n    afterEach(() => {\n      worker.terminate();\n    });\n\n    test(\"should create worker instance\", () => {\n      expect(Worker).toHaveBeenCalledWith(\"/workers/data-processing.js\");\n      expect(worker.getQueueSize()).toBe(0);\n    });\n\n    test(\"should process data with result\", async () => {\n      const testData = [1, 2, 3, 4, 5];\n      const task: ProcessingTask = {\n        id: \"test1\",\n        type: \"filter\",\n        data: testData,\n        options: { predicate: \"x => x > 2\" },\n      };\n\n      const result = await worker.processData(task);\n      expect(result.result).toEqual([3, 4, 5]);\n      expect(result.processingTime).toBe(10);\n    });\n\n    test(\"should handle worker errors\", async () => {\n      const testData = [1, 2, 3];\n      const task: ProcessingTask = {\n        id: \"test2\",\n        type: \"map\",\n        data: testData,\n      };\n\n      // Mock worker error response\n      const mockWorker = (Worker as jest.Mock).mock.results[0].value;\n      setTimeout(() => {\n        mockWorker.onmessage({\n          data: {\n            id: \"test2\",\n            error: \"Processing failed\",\n          },\n        });\n      }, 10);\n\n      await expect(worker.processData(task)).rejects.toThrow(\n        \"Processing failed\",\n      );\n    });\n\n    test(\"should filter data\", async () => {\n      const testData = [1, 2, 3, 4, 5];\n\n      // Mock worker response\n      const mockWorker = (Worker as jest.Mock).mock.results[0].value;\n      setTimeout(() => {\n        mockWorker.onmessage({\n          data: {\n            id: expect.any(String),\n            result: [4, 5],\n            processingTime: 50,\n          },\n        });\n      }, 10);\n\n      const result = await worker.filterData(testData, \"x => x > 3\");\n      expect(result).toEqual([4, 5]);\n    });\n\n    test(\"should map data\", async () => {\n      const testData = [1, 2, 3];\n\n      // Mock worker response\n      const mockWorker = (Worker as jest.Mock).mock.results[0].value;\n      setTimeout(() => {\n        mockWorker.onmessage({\n          data: {\n            id: expect.any(String),\n            result: [2, 4, 6],\n            processingTime: 30,\n          },\n        });\n      }, 10);\n\n      const result = await worker.mapData(testData, \"x => x * 2\");\n      expect(result).toEqual([2, 4, 6]);\n    });\n\n    test(\"should reduce data\", async () => {\n      const testData = [1, 2, 3, 4];\n\n      // Mock worker response\n      const mockWorker = (Worker as jest.Mock).mock.results[0].value;\n      setTimeout(() => {\n        mockWorker.onmessage({\n          data: {\n            id: expect.any(String),\n            result: 10,\n            processingTime: 20,\n          },\n        });\n      }, 10);\n\n      const result = await worker.reduceData(\n        testData,\n        \"(acc, val) => acc + val\",\n        0,\n      );\n      expect(result).toBe(10);\n    });\n\n    test(\"should sort data\", async () => {\n      const testData = [3, 1, 4, 1, 5];\n\n      // Mock worker response\n      const mockWorker = (Worker as jest.Mock).mock.results[0].value;\n      setTimeout(() => {\n        mockWorker.onmessage({\n          data: {\n            id: expect.any(String),\n            result: [1, 1, 3, 4, 5],\n            processingTime: 25,\n          },\n        });\n      }, 10);\n\n      const result = await worker.sortData(testData);\n      expect(result).toEqual([1, 1, 3, 4, 5]);\n    });\n\n    test(\"should aggregate data\", async () => {\n      const testData = [\n        { category: \"A\", value: 10 },\n        { category: \"B\", value: 20 },\n        { category: \"A\", value: 15 },\n      ];\n\n      // Mock worker response\n      const mockWorker = (Worker as jest.Mock).mock.results[0].value;\n      setTimeout(() => {\n        mockWorker.onmessage({\n          data: {\n            id: expect.any(String),\n            result: { A: 25, B: 20 },\n            processingTime: 40,\n          },\n        });\n      }, 10);\n\n      const result = await worker.aggregateData(testData, { sum: \"value\" });\n      expect(result).toEqual({ A: 25, B: 20 });\n    });\n\n    test(\"should handle task timeout\", async () => {\n      const testData = [1, 2, 3];\n      const task: ProcessingTask = {\n        id: \"timeout-test\",\n        type: \"filter\",\n        data: testData,\n      };\n\n      // Don't mock any response to trigger timeout\n\n      await expect(worker.processData(task)).rejects.toThrow(\"Task timeout\");\n    }, 150);\n\n    test(\"should handle queue size tracking\", () => {\n      expect(worker.getQueueSize()).toBe(0);\n\n      // Start a task (won't complete without mock response)\n      worker\n        .processData({\n          id: \"queue-test\",\n          type: \"map\",\n          data: [1, 2, 3],\n        })\n        .catch(() => {}); // Ignore the error\n\n      expect(worker.getQueueSize()).toBe(1);\n    });\n  });\n\n  describe(\"ImageProcessingWorker\", () => {\n    let worker: ImageProcessingWorker;\n    let mockImageData: ImageData;\n\n    beforeEach(() => {\n      worker = new ImageProcessingWorker();\n\n      // Mock ImageData\n      mockImageData = {\n        data: new Uint8ClampedArray([255, 0, 0, 255]), // Red pixel\n        width: 1,\n        height: 1,\n        colorSpace: \"srgb\",\n      } as ImageData;\n    });\n\n    afterEach(() => {\n      worker.terminate();\n    });\n\n    test(\"should create image processing worker\", () => {\n      expect(Worker).toHaveBeenCalledWith(\"/workers/image-processing.js\");\n    });\n\n    test(\"should resize image\", async () => {\n      const mockWorker = (Worker as jest.Mock).mock.results[0].value;\n      setTimeout(() => {\n        mockWorker.onmessage({\n          data: {\n            id: expect.any(String),\n            result: {\n              data: new Uint8ClampedArray([255, 0, 0, 255, 255, 0, 0, 255]),\n              width: 2,\n              height: 1,\n            },\n          },\n        });\n      }, 10);\n\n      const result = await worker.resizeImage(mockImageData, 2, 1);\n      expect(result.width).toBe(2);\n      expect(result.height).toBe(1);\n    });\n\n    test(\"should apply filter to image\", async () => {\n      const mockWorker = (Worker as jest.Mock).mock.results[0].value;\n      setTimeout(() => {\n        mockWorker.onmessage({\n          data: {\n            id: expect.any(String),\n            result: {\n              data: new Uint8ClampedArray([128, 128, 128, 255]), // Grayscale\n              width: 1,\n              height: 1,\n            },\n          },\n        });\n      }, 10);\n\n      const result = await worker.applyFilter(mockImageData, \"grayscale\", 1);\n      expect(result.data[0]).toBe(128); // Should be grayscale\n    });\n\n    test(\"should crop image\", async () => {\n      const mockWorker = (Worker as jest.Mock).mock.results[0].value;\n      setTimeout(() => {\n        mockWorker.onmessage({\n          data: {\n            id: expect.any(String),\n            result: mockImageData,\n          },\n        });\n      }, 10);\n\n      const result = await worker.cropImage(mockImageData, 0, 0, 1, 1);\n      expect(result).toBeDefined();\n    });\n\n    test(\"should rotate image\", async () => {\n      const mockWorker = (Worker as jest.Mock).mock.results[0].value;\n      setTimeout(() => {\n        mockWorker.onmessage({\n          data: {\n            id: expect.any(String),\n            result: mockImageData,\n          },\n        });\n      }, 10);\n\n      const result = await worker.rotateImage(mockImageData, 90);\n      expect(result).toBeDefined();\n    });\n\n    test(\"should adjust brightness\", async () => {\n      const mockWorker = (Worker as jest.Mock).mock.results[0].value;\n      setTimeout(() => {\n        mockWorker.onmessage({\n          data: {\n            id: expect.any(String),\n            result: {\n              data: new Uint8ClampedArray([255, 100, 100, 255]), // Brighter\n              width: 1,\n              height: 1,\n            },\n          },\n        });\n      }, 10);\n\n      const result = await worker.adjustBrightness(mockImageData, 1.5);\n      expect(result.data[1]).toBe(100); // Modified brightness\n    });\n\n    test(\"should adjust contrast\", async () => {\n      const mockWorker = (Worker as jest.Mock).mock.results[0].value;\n      setTimeout(() => {\n        mockWorker.onmessage({\n          data: {\n            id: expect.any(String),\n            result: {\n              data: new Uint8ClampedArray([255, 50, 50, 255]), // Higher contrast\n              width: 1,\n              height: 1,\n            },\n          },\n        });\n      }, 10);\n\n      const result = await worker.adjustContrast(mockImageData, 2);\n      expect(result.data[1]).toBe(50); // Modified contrast\n    });\n\n    test(\"should handle processing errors\", async () => {\n      const mockWorker = (Worker as jest.Mock).mock.results[0].value;\n      setTimeout(() => {\n        mockWorker.onmessage({\n          data: {\n            id: expect.any(String),\n            error: \"Invalid image format\",\n          },\n        });\n      }, 10);\n\n      await expect(worker.resizeImage(mockImageData, 0, 0)).rejects.toThrow(\n        \"Invalid image format\",\n      );\n    });\n\n    test(\"should handle processing timeout\", async () => {\n      // Don't mock any response to trigger timeout\n      await expect(worker.resizeImage(mockImageData, 100, 100)).rejects.toThrow(\n        \"Image processing timeout\",\n      );\n    }, 150);\n  });\n\n  describe(\"CrossTabCommunicator\", () => {\n    let communicator: CrossTabCommunicator;\n\n    beforeEach(() => {\n      communicator = new CrossTabCommunicator();\n    });\n\n    afterEach(() => {\n      communicator.disconnect();\n    });\n\n    test(\"should create shared worker for cross-tab communication\", () => {\n      expect(SharedWorker).toHaveBeenCalledWith(\"/workers/cross-tab.js\");\n    });\n\n    test(\"should broadcast messages\", () => {\n      const testData = { message: \"Hello from tab!\" };\n\n      communicator.broadcast(testData);\n\n      const mockPort = (SharedWorker as jest.Mock).mock.results[0].value.port;\n      expect(mockPort.postMessage).toHaveBeenCalledWith(\n        expect.objectContaining({\n          type: \"broadcast\",\n          data: testData,\n          tabId: expect.any(String),\n          timestamp: expect.any(Number),\n        }),\n      );\n    });\n\n    test(\"should sync data\", () => {\n      const syncData = { state: \"updated\" };\n\n      communicator.sync(syncData);\n\n      const mockPort = (SharedWorker as jest.Mock).mock.results[0].value.port;\n      expect(mockPort.postMessage).toHaveBeenCalledWith(\n        expect.objectContaining({\n          type: \"sync\",\n          data: syncData,\n        }),\n      );\n    });\n\n    test(\"should handle request-response pattern\", async () => {\n      const requestData = { query: \"getUserData\" };\n      const responseData = { user: { id: 1, name: \"Test User\" } };\n\n      // Mock response\n      const mockPort = (SharedWorker as jest.Mock).mock.results[0].value.port;\n      setTimeout(() => {\n        communicator.on(\"response\", (data) => {\n          if (data.requestId) {\n            // Simulate response from another tab\n          }\n        });\n\n        // Simulate receiving response\n        if (mockPort.onmessage) {\n          mockPort.onmessage({\n            data: {\n              type: \"response\",\n              data: { requestId: expect.any(String), data: responseData },\n              tabId: \"other-tab\",\n              timestamp: Date.now(),\n            },\n          });\n        }\n      }, 10);\n\n      const result = await communicator.request(requestData);\n      expect(result).toEqual(responseData);\n    });\n\n    test(\"should handle message handlers\", () => {\n      const handler = jest.fn();\n\n      communicator.on(\"broadcast\", handler);\n\n      // Simulate receiving message\n      const mockPort = (SharedWorker as jest.Mock).mock.results[0].value.port;\n      if (mockPort.onmessage) {\n        mockPort.onmessage({\n          data: {\n            type: \"broadcast\",\n            data: { test: \"data\" },\n            tabId: \"other-tab\",\n            timestamp: Date.now(),\n          },\n        });\n      }\n\n      expect(handler).toHaveBeenCalledWith({ test: \"data\" });\n    });\n\n    test(\"should remove message handlers\", () => {\n      const handler = jest.fn();\n\n      communicator.on(\"broadcast\", handler);\n      communicator.off(\"broadcast\", handler);\n\n      // Simulate receiving message\n      const mockPort = (SharedWorker as jest.Mock).mock.results[0].value.port;\n      if (mockPort.onmessage) {\n        mockPort.onmessage({\n          data: {\n            type: \"broadcast\",\n            data: { test: \"data\" },\n            tabId: \"other-tab\",\n            timestamp: Date.now(),\n          },\n        });\n      }\n\n      expect(handler).not.toHaveBeenCalled();\n    });\n\n    test(\"should ignore own messages\", () => {\n      const handler = jest.fn();\n      communicator.on(\"broadcast\", handler);\n\n      // Simulate receiving our own message\n      const mockPort = (SharedWorker as jest.Mock).mock.results[0].value.port;\n      const tabId = (communicator as any).tabId;\n\n      if (mockPort.onmessage) {\n        mockPort.onmessage({\n          data: {\n            type: \"broadcast\",\n            data: { test: \"data\" },\n            tabId: tabId,\n            timestamp: Date.now(),\n          },\n        });\n      }\n\n      expect(handler).not.toHaveBeenCalled();\n    });\n\n    test(\"should respond to requests\", () => {\n      const requestId = \"test-request-123\";\n      const responseData = { result: \"success\" };\n\n      communicator.respond(requestId, responseData);\n\n      const mockPort = (SharedWorker as jest.Mock).mock.results[0].value.port;\n      expect(mockPort.postMessage).toHaveBeenCalledWith(\n        expect.objectContaining({\n          type: \"response\",\n          data: { requestId, data: responseData },\n        }),\n      );\n    });\n  });\n\n  describe(\"ServiceWorkerManager\", () => {\n    let manager: ServiceWorkerManager;\n\n    beforeEach(() => {\n      manager = new ServiceWorkerManager();\n    });\n\n    test(\"should register service worker\", async () => {\n      const registration = await manager.register(\"/test-sw.js\");\n\n      expect(navigator.serviceWorker.register).toHaveBeenCalledWith(\n        \"/test-sw.js\",\n      );\n      expect(registration).toBeDefined();\n      expect(manager.isServiceWorkerRegistered()).toBe(true);\n    });\n\n    test(\"should unregister service worker\", async () => {\n      await manager.register();\n      const result = await manager.unregister();\n\n      expect(result).toBe(true);\n      expect(manager.isServiceWorkerRegistered()).toBe(false);\n    });\n\n    test(\"should update service worker\", async () => {\n      await manager.register();\n      await manager.update();\n\n      const registration = manager.getRegistration();\n      expect(registration?.update).toHaveBeenCalled();\n    });\n\n    test(\"should post message to service worker\", async () => {\n      await manager.register();\n      const message = { type: \"test\", data: \"hello\" };\n\n      manager.postMessage(message);\n\n      const registration = manager.getRegistration();\n      expect(registration?.active?.postMessage).toHaveBeenCalledWith(message);\n    });\n\n    test(\"should configure cache\", async () => {\n      await manager.register();\n      const configs: CacheConfig[] = [\n        {\n          name: \"api-cache\",\n          maxAge: 3600000,\n          maxEntries: 100,\n          strategy: \"network-first\",\n        },\n      ];\n\n      await manager.configureCache(configs);\n\n      const registration = manager.getRegistration();\n      expect(registration?.active?.postMessage).toHaveBeenCalledWith({\n        type: \"configure-cache\",\n        configs,\n      });\n    });\n\n    test(\"should clear cache\", async () => {\n      await manager.register();\n\n      await manager.clearCache(\"test-cache\");\n\n      const registration = manager.getRegistration();\n      expect(registration?.active?.postMessage).toHaveBeenCalledWith({\n        type: \"clear-cache\",\n        cacheName: \"test-cache\",\n      });\n    });\n\n    test(\"should get cache stats\", async () => {\n      await manager.register();\n\n      // This would timeout in real implementation without proper response\n      await expect(manager.getCacheStats()).rejects.toThrow(\n        \"Cache stats request timeout\",\n      );\n    });\n\n    test(\"should throw error when service worker not supported\", async () => {\n      // Mock unsupported environment\n      const originalServiceWorker = (global.navigator as any).serviceWorker;\n      delete (global.navigator as any).serviceWorker;\n\n      const unsupportedManager = new ServiceWorkerManager();\n\n      await expect(unsupportedManager.register()).rejects.toThrow(\n        \"Service Worker not supported\",\n      );\n\n      // Restore\n      (global.navigator as any).serviceWorker = originalServiceWorker;\n    });\n\n    test(\"should throw error when posting message without active worker\", async () => {\n      expect(() => {\n        manager.postMessage({ test: \"data\" });\n      }).toThrow(\"No active Service Worker\");\n    });\n  });\n\n  describe(\"BackgroundSyncManager\", () => {\n    let syncManager: BackgroundSyncManager;\n    let serviceWorkerManager: ServiceWorkerManager;\n\n    beforeEach(async () => {\n      serviceWorkerManager = new ServiceWorkerManager();\n      await serviceWorkerManager.register();\n      syncManager = new BackgroundSyncManager(serviceWorkerManager);\n    });\n\n    test(\"should schedule sync task\", async () => {\n      const taskData = { action: \"uploadFile\", fileId: \"123\" };\n\n      const taskId = await syncManager.scheduleSync(\"file-upload\", taskData);\n\n      expect(taskId).toBeDefined();\n      expect(syncManager.getPendingTasks()).toHaveLength(1);\n      expect(\n        serviceWorkerManager.getRegistration()?.active?.postMessage,\n      ).toHaveBeenCalledWith(\n        expect.objectContaining({\n          type: \"schedule-sync\",\n          task: expect.objectContaining({\n            id: taskId,\n            type: \"file-upload\",\n            data: taskData,\n          }),\n        }),\n      );\n    });\n\n    test(\"should cancel sync task\", async () => {\n      const taskId = await syncManager.scheduleSync(\"test-sync\", {\n        data: \"test\",\n      });\n\n      const cancelled = await syncManager.cancelSync(taskId);\n\n      expect(cancelled).toBe(true);\n      expect(syncManager.getPendingTasks()).toHaveLength(0);\n      expect(\n        serviceWorkerManager.getRegistration()?.active?.postMessage,\n      ).toHaveBeenCalledWith(\n        expect.objectContaining({\n          type: \"cancel-sync\",\n          taskId,\n        }),\n      );\n    });\n\n    test(\"should retry failed tasks\", async () => {\n      const taskId = await syncManager.scheduleSync(\"test-sync\", {\n        data: \"test\",\n      });\n\n      await syncManager.retryFailedTasks();\n\n      const task = syncManager.getTaskStatus(taskId);\n      expect(task?.retryCount).toBe(1);\n      expect(\n        serviceWorkerManager.getRegistration()?.active?.postMessage,\n      ).toHaveBeenCalledWith(\n        expect.objectContaining({\n          type: \"retry-sync\",\n          task: expect.objectContaining({\n            id: taskId,\n            retryCount: 1,\n          }),\n        }),\n      );\n    });\n\n    test(\"should get task status\", async () => {\n      const taskId = await syncManager.scheduleSync(\"test-sync\", {\n        data: \"test\",\n      });\n\n      const status = syncManager.getTaskStatus(taskId);\n\n      expect(status).toBeDefined();\n      expect(status?.id).toBe(taskId);\n      expect(status?.type).toBe(\"test-sync\");\n    });\n\n    test(\"should clear completed tasks\", async () => {\n      const taskId = await syncManager.scheduleSync(\n        \"test-sync\",\n        { data: \"test\" },\n        { maxRetries: 0 },\n      );\n\n      // Simulate task failure by setting retry count to max\n      const task = syncManager.getTaskStatus(taskId);\n      if (task) {\n        task.retryCount = task.maxRetries;\n      }\n\n      syncManager.clearCompletedTasks();\n\n      expect(syncManager.getTaskStatus(taskId)).toBeUndefined();\n    });\n\n    test(\"should handle task with custom max retries\", async () => {\n      const taskId = await syncManager.scheduleSync(\n        \"test-sync\",\n        { data: \"test\" },\n        { maxRetries: 5 },\n      );\n\n      const task = syncManager.getTaskStatus(taskId);\n      expect(task?.maxRetries).toBe(5);\n    });\n\n    test(\"should not cancel non-existent task\", async () => {\n      const cancelled = await syncManager.cancelSync(\"non-existent-id\");\n\n      expect(cancelled).toBe(false);\n    });\n  });\n});\n"],"names":["global","Worker","jest","fn","postMessage","terminate","onmessage","onerror","onmessageerror","SharedWorker","port","start","close","ServiceWorker","state","onstatechange","navigator","serviceWorker","register","Promise","resolve","installing","waiting","active","scope","update","unregister","addEventListener","removeEventListener","ready","controller","getRegistration","getRegistrations","DataProcessingWorker","constructor","workerScript","pendingTasks","Map","worker","handleMessage","bind","handleError","originalPostMessage","data","call","setTimeout","id","result","processDataSync","processingTime","task","type","filter","x","map","reduce","acc","val","options","initialValue","sort","A","B","event","error","get","reject","Error","delete","console","forEach","clear","processData","taskId","Math","random","toString","startTime","Date","now","set","has","filterData","predicate","mapData","mapper","reduceData","reducer","sortData","compareFn","aggregateData","aggregations","getQueueSize","size","ImageProcessingWorker","processImage","resizeImage","imageData","width","height","applyFilter","filterType","intensity","cropImage","y","rotateImage","angle","adjustBrightness","brightness","adjustContrast","contrast","CrossTabCommunicator","messageHandlers","tabId","sharedWorker","handleMessageError","sendMessage","action","timestamp","handler","generalHandler","message","broadcast","sync","request","requestId","responseHandler","responseData","off","on","respond","messageType","currentHandler","disconnect","ServiceWorkerManager","scriptUrl","registration","isRegistered","handleUpdateFound","newWorker","log","configureCache","configs","clearCache","cacheName","getCacheStats","channel","MessageChannel","port1","port2","isServiceWorkerRegistered","BackgroundSyncManager","serviceWorkerManager","tasks","scheduleSync","retryCount","maxRetries","createdAt","cancelSync","retryFailedTasks","failedTasks","Array","from","values","getPendingTasks","getTaskStatus","clearCompletedTasks","completedTasks","entries","_","describe","beforeEach","afterEach","test","expect","toHaveBeenCalledWith","toBe","testData","toEqual","mockWorker","mock","results","value","rejects","toThrow","any","String","category","sum","catch","mockImageData","Uint8ClampedArray","colorSpace","toBeDefined","communicator","mockPort","objectContaining","Number","syncData","requestData","query","user","name","not","toHaveBeenCalled","manager","maxAge","maxEntries","strategy","originalServiceWorker","unsupportedManager","syncManager","taskData","fileId","toHaveLength","cancelled","status","toBeUndefined"],"mappings":"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"}