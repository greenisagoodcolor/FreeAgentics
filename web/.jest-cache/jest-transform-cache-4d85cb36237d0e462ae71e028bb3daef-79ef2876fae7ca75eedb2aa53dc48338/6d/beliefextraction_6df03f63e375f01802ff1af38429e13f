135e5738a70d0d25bc49c9dfabebfbe0
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    createFallbackRefinedBeliefs: function() {
        return createFallbackRefinedBeliefs;
    },
    parseBeliefs: function() {
        return parseBeliefs;
    },
    parseRefinedBeliefs: function() {
        return parseRefinedBeliefs;
    }
});
const _utils = require("./utils");
function createFallbackRefinedBeliefs(beliefs) {
    return beliefs.map((belief, index)=>({
            originalIndex: index,
            accuracy: 3,
            relevance: 3,
            category: "Fact",
            title: `Knowledge about ${belief.tags[0] || "topic"}`,
            refined_content: belief.content,
            confidence: belief.confidence,
            tags: belief.tags,
            selected: true,
            novelty: "Medium"
        }));
}
function parseBeliefs(response) {
    const beliefs = [];
    // Split by bullet points or numbered lists, but only process top-level items (not indented sub-items)
    const lines = response.split(/\n+/).filter((line)=>{
        const trimmed = line.trim();
        // Must be a bullet/number format
        if (!(trimmed.startsWith("-") || trimmed.startsWith("•") || /^\d+\./.test(trimmed))) {
            return false;
        }
        // Check for excessive indentation (more than 8 spaces suggests a sub-item)
        // This allows for reasonable formatting indentation while filtering true sub-items
        const leadingSpaces = line.match(/^ */)[0].length;
        return leadingSpaces <= 8;
    });
    for (const line of lines){
        // Remove bullet points, numbers, and leading whitespace
        const withoutBullets = line.replace(/^\s*[-•]\s*/, "").replace(/^\s*\d+\.\s*/, "").trim();
        // Extract confidence level if present (case insensitive, use last occurrence)
        let confidence = "Medium";
        const confidenceMatches = Array.from(withoutBullets.matchAll(/\$\$(High|Medium|Low)\$\$/gi));
        if (confidenceMatches.length > 0) {
            // Use the last confidence marker found and preserve its exact case
            const lastMatch = confidenceMatches[confidenceMatches.length - 1];
            const originalCase = lastMatch[1];
            // Preserve original case while ensuring type safety
            if (originalCase.toLowerCase() === "high") {
                confidence = originalCase;
            } else if (originalCase.toLowerCase() === "medium") {
                confidence = originalCase;
            } else if (originalCase.toLowerCase() === "low") {
                confidence = originalCase;
            }
        }
        // Clean up the content by removing confidence markers and preserving [[tags]]
        const cleanContent = withoutBullets.replace(/\$\$(High|Medium|Low)\$\$/gi, "").trim();
        // Extract tags using the existing utility
        const tags = (0, _utils.extractTagsFromMarkdown)(cleanContent);
        if (cleanContent) {
            beliefs.push({
                content: cleanContent,
                confidence,
                source: "conversation",
                tags
            });
        }
    }
    return beliefs;
}
/**
 * Filters out beliefs that are duplicates of existing knowledge
 */ function filterDuplicateBeliefs(beliefs, existingKnowledge) {
    // Simple implementation - can be enhanced with more sophisticated similarity detection
    return beliefs.filter((belief)=>{
        // Check if this belief is similar to any existing knowledge
        return !existingKnowledge.some((entry)=>{
            // Check for content similarity
            const contentSimilarity = calculateTextSimilarity(belief.content, entry.content);
            // Check for tag overlap
            const tagOverlap = belief.tags.some((tag)=>entry.tags.includes(tag));
            // Consider it a duplicate if content is very similar or there's significant tag overlap
            return contentSimilarity > 0.7 || tagOverlap && contentSimilarity > 0.5;
        });
    });
}
/**
 * Calculates text similarity between two strings (simple implementation)
 */ function calculateTextSimilarity(text1, text2) {
    // Normalize texts
    const normalize = (text)=>text.toLowerCase().replace(/[^\w\s]/g, "");
    const normalizedText1 = normalize(text1);
    const normalizedText2 = normalize(text2);
    // Simple word overlap for now
    const words1 = new Set(normalizedText1.split(/\s+/));
    const words2 = new Set(normalizedText2.split(/\s+/));
    // Count common words
    let commonWords = 0;
    for (const word of words1){
        if (words2.has(word)) commonWords++;
    }
    // Calculate Jaccard similarity
    const totalUniqueWords = new Set([
        ...words1,
        ...words2
    ]).size;
    return totalUniqueWords > 0 ? commonWords / totalUniqueWords : 0;
}
function parseRefinedBeliefs(response, sourceBeliefs) {
    try {
        // Attempt to parse the JSON response
        const refinedBeliefs = JSON.parse(response);
        // Validate the parsed beliefs to ensure they have the required properties
        const validBeliefs = refinedBeliefs.filter((belief)=>belief && typeof belief.originalIndex === "number" && typeof belief.refined_content === "string" && belief.refined_content.trim() !== "");
        if (validBeliefs.length === 0) {
            console.warn("No valid beliefs found in parsed JSON");
            return createFallbackRefinedBeliefs(sourceBeliefs);
        }
        // Set all beliefs as selected by default and ensure tags are properly extracted
        return validBeliefs.map((belief)=>({
                ...belief,
                selected: belief.selected !== false,
                // Ensure tags are properly extracted if missing
                tags: belief.tags || (0, _utils.extractTagsFromMarkdown)(belief.refined_content),
                // Add novelty field if missing
                novelty: belief.novelty || "Medium"
            }));
    } catch (error) {
        console.error("Error parsing refined beliefs JSON:", error);
        console.log("Raw response:", response);
        return createFallbackRefinedBeliefs(sourceBeliefs);
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYXR0aGV3bW9yb25leS9idWlsZHMvRnJlZUFnZW50aWNzL3dlYi9saWIvYmVsaWVmLWV4dHJhY3Rpb24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBLbm93bGVkZ2VFbnRyeSB9IGZyb20gXCJAL2xpYi90eXBlc1wiO1xuaW1wb3J0IHsgZXh0cmFjdFRhZ3NGcm9tTWFya2Rvd24gfSBmcm9tIFwiQC9saWIvdXRpbHNcIjtcbi8vIGltcG9ydCB7IGdlbmVyYXRlUmVzcG9uc2UgfSBmcm9tIFwiQC9saWIvbGxtLXNlcnZpY2VcIiAvLyBBdm9pZCBkaXJlY3QgaW1wb3J0IGZyb20gbGxtLXNlcnZpY2VcblxuLy8gVHlwZXMgZm9yIHRoZSBiZWxpZWYgZXh0cmFjdGlvbiBwaXBlbGluZVxuZXhwb3J0IGludGVyZmFjZSBFeHRyYWN0ZWRCZWxpZWYge1xuICBjb250ZW50OiBzdHJpbmc7XG4gIGNvbmZpZGVuY2U6IFwiSGlnaFwiIHwgXCJNZWRpdW1cIiB8IFwiTG93XCI7XG4gIHNvdXJjZTogXCJjb252ZXJzYXRpb25cIjtcbiAgdGFnczogc3RyaW5nW107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVmaW5lZEJlbGllZiB7XG4gIG9yaWdpbmFsSW5kZXg6IG51bWJlcjtcbiAgYWNjdXJhY3k6IG51bWJlcjsgLy8gMS01IHNjYWxlXG4gIHJlbGV2YW5jZTogbnVtYmVyOyAvLyAxLTUgc2NhbGVcbiAgY2F0ZWdvcnk6IFwiRmFjdFwiIHwgXCJPcGluaW9uXCIgfCBcIlByZWZlcmVuY2VcIiB8IFwiUmVsYXRpb25zaGlwXCIgfCBcIk90aGVyXCI7XG4gIHRpdGxlOiBzdHJpbmc7XG4gIHJlZmluZWRfY29udGVudDogc3RyaW5nO1xuICBjb25maWRlbmNlOiBcIkhpZ2hcIiB8IFwiTWVkaXVtXCIgfCBcIkxvd1wiO1xuICB0YWdzOiBzdHJpbmdbXTtcbiAgc2VsZWN0ZWQ/OiBib29sZWFuO1xuICBub3ZlbHR5PzogXCJIaWdoXCIgfCBcIk1lZGl1bVwiIHwgXCJMb3dcIjtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGZhbGxiYWNrIHJlZmluZWQgYmVsaWVmcyB3aGVuIExMTSByZWZpbmVtZW50IGZhaWxzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVGYWxsYmFja1JlZmluZWRCZWxpZWZzKFxuICBiZWxpZWZzOiBFeHRyYWN0ZWRCZWxpZWZbXSxcbik6IFJlZmluZWRCZWxpZWZbXSB7XG4gIHJldHVybiBiZWxpZWZzLm1hcCgoYmVsaWVmLCBpbmRleCkgPT4gKHtcbiAgICBvcmlnaW5hbEluZGV4OiBpbmRleCxcbiAgICBhY2N1cmFjeTogMywgLy8gTWVkaXVtIGFjY3VyYWN5XG4gICAgcmVsZXZhbmNlOiAzLCAvLyBNZWRpdW0gcmVsZXZhbmNlXG4gICAgY2F0ZWdvcnk6IFwiRmFjdFwiIGFzIGNvbnN0LFxuICAgIHRpdGxlOiBgS25vd2xlZGdlIGFib3V0ICR7YmVsaWVmLnRhZ3NbMF0gfHwgXCJ0b3BpY1wifWAsXG4gICAgcmVmaW5lZF9jb250ZW50OiBiZWxpZWYuY29udGVudCxcbiAgICBjb25maWRlbmNlOiBiZWxpZWYuY29uZmlkZW5jZSxcbiAgICB0YWdzOiBiZWxpZWYudGFncyxcbiAgICBzZWxlY3RlZDogdHJ1ZSxcbiAgICBub3ZlbHR5OiBcIk1lZGl1bVwiLFxuICB9KSk7XG59XG5cbi8qKlxuICogUGFyc2VzIHJhdyBMTE0gcmVzcG9uc2UgdG8gZXh0cmFjdCBiZWxpZWZzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZUJlbGllZnMocmVzcG9uc2U6IHN0cmluZyk6IEV4dHJhY3RlZEJlbGllZltdIHtcbiAgY29uc3QgYmVsaWVmczogRXh0cmFjdGVkQmVsaWVmW10gPSBbXTtcblxuICAvLyBTcGxpdCBieSBidWxsZXQgcG9pbnRzIG9yIG51bWJlcmVkIGxpc3RzLCBidXQgb25seSBwcm9jZXNzIHRvcC1sZXZlbCBpdGVtcyAobm90IGluZGVudGVkIHN1Yi1pdGVtcylcbiAgY29uc3QgbGluZXMgPSByZXNwb25zZVxuICAgIC5zcGxpdCgvXFxuKy8pXG4gICAgLmZpbHRlcihcbiAgICAgIChsaW5lKSA9PiB7XG4gICAgICAgIGNvbnN0IHRyaW1tZWQgPSBsaW5lLnRyaW0oKTtcbiAgICAgICAgLy8gTXVzdCBiZSBhIGJ1bGxldC9udW1iZXIgZm9ybWF0XG4gICAgICAgIGlmICghKHRyaW1tZWQuc3RhcnRzV2l0aChcIi1cIikgfHwgdHJpbW1lZC5zdGFydHNXaXRoKFwi4oCiXCIpIHx8IC9eXFxkK1xcLi8udGVzdCh0cmltbWVkKSkpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQ2hlY2sgZm9yIGV4Y2Vzc2l2ZSBpbmRlbnRhdGlvbiAobW9yZSB0aGFuIDggc3BhY2VzIHN1Z2dlc3RzIGEgc3ViLWl0ZW0pXG4gICAgICAgIC8vIFRoaXMgYWxsb3dzIGZvciByZWFzb25hYmxlIGZvcm1hdHRpbmcgaW5kZW50YXRpb24gd2hpbGUgZmlsdGVyaW5nIHRydWUgc3ViLWl0ZW1zXG4gICAgICAgIGNvbnN0IGxlYWRpbmdTcGFjZXMgPSBsaW5lLm1hdGNoKC9eICovKVswXS5sZW5ndGg7XG4gICAgICAgIHJldHVybiBsZWFkaW5nU3BhY2VzIDw9IDg7XG4gICAgICB9XG4gICAgKTtcblxuICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcbiAgICAvLyBSZW1vdmUgYnVsbGV0IHBvaW50cywgbnVtYmVycywgYW5kIGxlYWRpbmcgd2hpdGVzcGFjZVxuICAgIGNvbnN0IHdpdGhvdXRCdWxsZXRzID0gbGluZS5yZXBsYWNlKC9eXFxzKlst4oCiXVxccyovLCBcIlwiKS5yZXBsYWNlKC9eXFxzKlxcZCtcXC5cXHMqLywgXCJcIikudHJpbSgpO1xuXG4gICAgLy8gRXh0cmFjdCBjb25maWRlbmNlIGxldmVsIGlmIHByZXNlbnQgKGNhc2UgaW5zZW5zaXRpdmUsIHVzZSBsYXN0IG9jY3VycmVuY2UpXG4gICAgbGV0IGNvbmZpZGVuY2U6IFwiSGlnaFwiIHwgXCJNZWRpdW1cIiB8IFwiTG93XCIgPSBcIk1lZGl1bVwiO1xuICAgIGNvbnN0IGNvbmZpZGVuY2VNYXRjaGVzID0gQXJyYXkuZnJvbSh3aXRob3V0QnVsbGV0cy5tYXRjaEFsbCgvXFwkXFwkKEhpZ2h8TWVkaXVtfExvdylcXCRcXCQvZ2kpKTtcbiAgICBcbiAgICBpZiAoY29uZmlkZW5jZU1hdGNoZXMubGVuZ3RoID4gMCkge1xuICAgICAgLy8gVXNlIHRoZSBsYXN0IGNvbmZpZGVuY2UgbWFya2VyIGZvdW5kIGFuZCBwcmVzZXJ2ZSBpdHMgZXhhY3QgY2FzZVxuICAgICAgY29uc3QgbGFzdE1hdGNoID0gY29uZmlkZW5jZU1hdGNoZXNbY29uZmlkZW5jZU1hdGNoZXMubGVuZ3RoIC0gMV07XG4gICAgICBjb25zdCBvcmlnaW5hbENhc2UgPSBsYXN0TWF0Y2hbMV07XG4gICAgICAvLyBQcmVzZXJ2ZSBvcmlnaW5hbCBjYXNlIHdoaWxlIGVuc3VyaW5nIHR5cGUgc2FmZXR5XG4gICAgICBpZiAob3JpZ2luYWxDYXNlLnRvTG93ZXJDYXNlKCkgPT09IFwiaGlnaFwiKSB7XG4gICAgICAgIGNvbmZpZGVuY2UgPSBvcmlnaW5hbENhc2UgYXMgYW55O1xuICAgICAgfSBlbHNlIGlmIChvcmlnaW5hbENhc2UudG9Mb3dlckNhc2UoKSA9PT0gXCJtZWRpdW1cIikge1xuICAgICAgICBjb25maWRlbmNlID0gb3JpZ2luYWxDYXNlIGFzIGFueTtcbiAgICAgIH0gZWxzZSBpZiAob3JpZ2luYWxDYXNlLnRvTG93ZXJDYXNlKCkgPT09IFwibG93XCIpIHtcbiAgICAgICAgY29uZmlkZW5jZSA9IG9yaWdpbmFsQ2FzZSBhcyBhbnk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ2xlYW4gdXAgdGhlIGNvbnRlbnQgYnkgcmVtb3ZpbmcgY29uZmlkZW5jZSBtYXJrZXJzIGFuZCBwcmVzZXJ2aW5nIFtbdGFnc11dXG4gICAgY29uc3QgY2xlYW5Db250ZW50ID0gd2l0aG91dEJ1bGxldHNcbiAgICAgIC5yZXBsYWNlKC9cXCRcXCQoSGlnaHxNZWRpdW18TG93KVxcJFxcJC9naSwgXCJcIilcbiAgICAgIC50cmltKCk7XG5cbiAgICAvLyBFeHRyYWN0IHRhZ3MgdXNpbmcgdGhlIGV4aXN0aW5nIHV0aWxpdHlcbiAgICBjb25zdCB0YWdzID0gZXh0cmFjdFRhZ3NGcm9tTWFya2Rvd24oY2xlYW5Db250ZW50KTtcblxuICAgIGlmIChjbGVhbkNvbnRlbnQpIHtcbiAgICAgIGJlbGllZnMucHVzaCh7XG4gICAgICAgIGNvbnRlbnQ6IGNsZWFuQ29udGVudCxcbiAgICAgICAgY29uZmlkZW5jZSxcbiAgICAgICAgc291cmNlOiBcImNvbnZlcnNhdGlvblwiLFxuICAgICAgICB0YWdzLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGJlbGllZnM7XG59XG5cbi8qKlxuICogRmlsdGVycyBvdXQgYmVsaWVmcyB0aGF0IGFyZSBkdXBsaWNhdGVzIG9mIGV4aXN0aW5nIGtub3dsZWRnZVxuICovXG5mdW5jdGlvbiBmaWx0ZXJEdXBsaWNhdGVCZWxpZWZzKFxuICBiZWxpZWZzOiBFeHRyYWN0ZWRCZWxpZWZbXSxcbiAgZXhpc3RpbmdLbm93bGVkZ2U6IEtub3dsZWRnZUVudHJ5W10sXG4pOiBFeHRyYWN0ZWRCZWxpZWZbXSB7XG4gIC8vIFNpbXBsZSBpbXBsZW1lbnRhdGlvbiAtIGNhbiBiZSBlbmhhbmNlZCB3aXRoIG1vcmUgc29waGlzdGljYXRlZCBzaW1pbGFyaXR5IGRldGVjdGlvblxuICByZXR1cm4gYmVsaWVmcy5maWx0ZXIoKGJlbGllZikgPT4ge1xuICAgIC8vIENoZWNrIGlmIHRoaXMgYmVsaWVmIGlzIHNpbWlsYXIgdG8gYW55IGV4aXN0aW5nIGtub3dsZWRnZVxuICAgIHJldHVybiAhZXhpc3RpbmdLbm93bGVkZ2Uuc29tZSgoZW50cnkpID0+IHtcbiAgICAgIC8vIENoZWNrIGZvciBjb250ZW50IHNpbWlsYXJpdHlcbiAgICAgIGNvbnN0IGNvbnRlbnRTaW1pbGFyaXR5ID0gY2FsY3VsYXRlVGV4dFNpbWlsYXJpdHkoXG4gICAgICAgIGJlbGllZi5jb250ZW50LFxuICAgICAgICBlbnRyeS5jb250ZW50LFxuICAgICAgKTtcblxuICAgICAgLy8gQ2hlY2sgZm9yIHRhZyBvdmVybGFwXG4gICAgICBjb25zdCB0YWdPdmVybGFwID0gYmVsaWVmLnRhZ3Muc29tZSgodGFnKSA9PiBlbnRyeS50YWdzLmluY2x1ZGVzKHRhZykpO1xuXG4gICAgICAvLyBDb25zaWRlciBpdCBhIGR1cGxpY2F0ZSBpZiBjb250ZW50IGlzIHZlcnkgc2ltaWxhciBvciB0aGVyZSdzIHNpZ25pZmljYW50IHRhZyBvdmVybGFwXG4gICAgICByZXR1cm4gY29udGVudFNpbWlsYXJpdHkgPiAwLjcgfHwgKHRhZ092ZXJsYXAgJiYgY29udGVudFNpbWlsYXJpdHkgPiAwLjUpO1xuICAgIH0pO1xuICB9KTtcbn1cblxuLyoqXG4gKiBDYWxjdWxhdGVzIHRleHQgc2ltaWxhcml0eSBiZXR3ZWVuIHR3byBzdHJpbmdzIChzaW1wbGUgaW1wbGVtZW50YXRpb24pXG4gKi9cbmZ1bmN0aW9uIGNhbGN1bGF0ZVRleHRTaW1pbGFyaXR5KHRleHQxOiBzdHJpbmcsIHRleHQyOiBzdHJpbmcpOiBudW1iZXIge1xuICAvLyBOb3JtYWxpemUgdGV4dHNcbiAgY29uc3Qgbm9ybWFsaXplID0gKHRleHQ6IHN0cmluZykgPT5cbiAgICB0ZXh0LnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvW15cXHdcXHNdL2csIFwiXCIpO1xuICBjb25zdCBub3JtYWxpemVkVGV4dDEgPSBub3JtYWxpemUodGV4dDEpO1xuICBjb25zdCBub3JtYWxpemVkVGV4dDIgPSBub3JtYWxpemUodGV4dDIpO1xuXG4gIC8vIFNpbXBsZSB3b3JkIG92ZXJsYXAgZm9yIG5vd1xuICBjb25zdCB3b3JkczEgPSBuZXcgU2V0KG5vcm1hbGl6ZWRUZXh0MS5zcGxpdCgvXFxzKy8pKTtcbiAgY29uc3Qgd29yZHMyID0gbmV3IFNldChub3JtYWxpemVkVGV4dDIuc3BsaXQoL1xccysvKSk7XG5cbiAgLy8gQ291bnQgY29tbW9uIHdvcmRzXG4gIGxldCBjb21tb25Xb3JkcyA9IDA7XG4gIGZvciAoY29uc3Qgd29yZCBvZiB3b3JkczEpIHtcbiAgICBpZiAod29yZHMyLmhhcyh3b3JkKSkgY29tbW9uV29yZHMrKztcbiAgfVxuXG4gIC8vIENhbGN1bGF0ZSBKYWNjYXJkIHNpbWlsYXJpdHlcbiAgY29uc3QgdG90YWxVbmlxdWVXb3JkcyA9IG5ldyBTZXQoWy4uLndvcmRzMSwgLi4ud29yZHMyXSkuc2l6ZTtcbiAgcmV0dXJuIHRvdGFsVW5pcXVlV29yZHMgPiAwID8gY29tbW9uV29yZHMgLyB0b3RhbFVuaXF1ZVdvcmRzIDogMDtcbn1cblxuLyoqXG4gKiBQYXJzZXMgcmVmaW5lZCBiZWxpZWZzIGZyb20gYSBKU09OIHN0cmluZywgaGFuZGxpbmcgcG90ZW50aWFsIGVycm9ycy5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlUmVmaW5lZEJlbGllZnMoXG4gIHJlc3BvbnNlOiBzdHJpbmcsXG4gIHNvdXJjZUJlbGllZnM6IEV4dHJhY3RlZEJlbGllZltdLFxuKTogUmVmaW5lZEJlbGllZltdIHtcbiAgdHJ5IHtcbiAgICAvLyBBdHRlbXB0IHRvIHBhcnNlIHRoZSBKU09OIHJlc3BvbnNlXG4gICAgY29uc3QgcmVmaW5lZEJlbGllZnMgPSBKU09OLnBhcnNlKHJlc3BvbnNlKSBhcyBSZWZpbmVkQmVsaWVmW107XG5cbiAgICAvLyBWYWxpZGF0ZSB0aGUgcGFyc2VkIGJlbGllZnMgdG8gZW5zdXJlIHRoZXkgaGF2ZSB0aGUgcmVxdWlyZWQgcHJvcGVydGllc1xuICAgIGNvbnN0IHZhbGlkQmVsaWVmcyA9IHJlZmluZWRCZWxpZWZzLmZpbHRlcihcbiAgICAgIChiZWxpZWYpID0+XG4gICAgICAgIGJlbGllZiAmJlxuICAgICAgICB0eXBlb2YgYmVsaWVmLm9yaWdpbmFsSW5kZXggPT09IFwibnVtYmVyXCIgJiZcbiAgICAgICAgdHlwZW9mIGJlbGllZi5yZWZpbmVkX2NvbnRlbnQgPT09IFwic3RyaW5nXCIgJiZcbiAgICAgICAgYmVsaWVmLnJlZmluZWRfY29udGVudC50cmltKCkgIT09IFwiXCIsXG4gICAgKTtcblxuICAgIGlmICh2YWxpZEJlbGllZnMubGVuZ3RoID09PSAwKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCJObyB2YWxpZCBiZWxpZWZzIGZvdW5kIGluIHBhcnNlZCBKU09OXCIpO1xuICAgICAgcmV0dXJuIGNyZWF0ZUZhbGxiYWNrUmVmaW5lZEJlbGllZnMoc291cmNlQmVsaWVmcyk7XG4gICAgfVxuXG4gICAgLy8gU2V0IGFsbCBiZWxpZWZzIGFzIHNlbGVjdGVkIGJ5IGRlZmF1bHQgYW5kIGVuc3VyZSB0YWdzIGFyZSBwcm9wZXJseSBleHRyYWN0ZWRcbiAgICByZXR1cm4gdmFsaWRCZWxpZWZzLm1hcCgoYmVsaWVmKSA9PiAoe1xuICAgICAgLi4uYmVsaWVmLFxuICAgICAgc2VsZWN0ZWQ6IGJlbGllZi5zZWxlY3RlZCAhPT0gZmFsc2UsIC8vIERlZmF1bHQgdG8gdHJ1ZSBpZiBub3QgZXhwbGljaXRseSBzZXQgdG8gZmFsc2VcbiAgICAgIC8vIEVuc3VyZSB0YWdzIGFyZSBwcm9wZXJseSBleHRyYWN0ZWQgaWYgbWlzc2luZ1xuICAgICAgdGFnczogYmVsaWVmLnRhZ3MgfHwgZXh0cmFjdFRhZ3NGcm9tTWFya2Rvd24oYmVsaWVmLnJlZmluZWRfY29udGVudCksXG4gICAgICAvLyBBZGQgbm92ZWx0eSBmaWVsZCBpZiBtaXNzaW5nXG4gICAgICBub3ZlbHR5OiBiZWxpZWYubm92ZWx0eSB8fCBcIk1lZGl1bVwiLFxuICAgIH0pKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcGFyc2luZyByZWZpbmVkIGJlbGllZnMgSlNPTjpcIiwgZXJyb3IpO1xuICAgIGNvbnNvbGUubG9nKFwiUmF3IHJlc3BvbnNlOlwiLCByZXNwb25zZSk7XG4gICAgcmV0dXJuIGNyZWF0ZUZhbGxiYWNrUmVmaW5lZEJlbGllZnMoc291cmNlQmVsaWVmcyk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJjcmVhdGVGYWxsYmFja1JlZmluZWRCZWxpZWZzIiwicGFyc2VCZWxpZWZzIiwicGFyc2VSZWZpbmVkQmVsaWVmcyIsImJlbGllZnMiLCJtYXAiLCJiZWxpZWYiLCJpbmRleCIsIm9yaWdpbmFsSW5kZXgiLCJhY2N1cmFjeSIsInJlbGV2YW5jZSIsImNhdGVnb3J5IiwidGl0bGUiLCJ0YWdzIiwicmVmaW5lZF9jb250ZW50IiwiY29udGVudCIsImNvbmZpZGVuY2UiLCJzZWxlY3RlZCIsIm5vdmVsdHkiLCJyZXNwb25zZSIsImxpbmVzIiwic3BsaXQiLCJmaWx0ZXIiLCJsaW5lIiwidHJpbW1lZCIsInRyaW0iLCJzdGFydHNXaXRoIiwidGVzdCIsImxlYWRpbmdTcGFjZXMiLCJtYXRjaCIsImxlbmd0aCIsIndpdGhvdXRCdWxsZXRzIiwicmVwbGFjZSIsImNvbmZpZGVuY2VNYXRjaGVzIiwiQXJyYXkiLCJmcm9tIiwibWF0Y2hBbGwiLCJsYXN0TWF0Y2giLCJvcmlnaW5hbENhc2UiLCJ0b0xvd2VyQ2FzZSIsImNsZWFuQ29udGVudCIsImV4dHJhY3RUYWdzRnJvbU1hcmtkb3duIiwicHVzaCIsInNvdXJjZSIsImZpbHRlckR1cGxpY2F0ZUJlbGllZnMiLCJleGlzdGluZ0tub3dsZWRnZSIsInNvbWUiLCJlbnRyeSIsImNvbnRlbnRTaW1pbGFyaXR5IiwiY2FsY3VsYXRlVGV4dFNpbWlsYXJpdHkiLCJ0YWdPdmVybGFwIiwidGFnIiwiaW5jbHVkZXMiLCJ0ZXh0MSIsInRleHQyIiwibm9ybWFsaXplIiwidGV4dCIsIm5vcm1hbGl6ZWRUZXh0MSIsIm5vcm1hbGl6ZWRUZXh0MiIsIndvcmRzMSIsIlNldCIsIndvcmRzMiIsImNvbW1vbldvcmRzIiwid29yZCIsImhhcyIsInRvdGFsVW5pcXVlV29yZHMiLCJzaXplIiwic291cmNlQmVsaWVmcyIsInJlZmluZWRCZWxpZWZzIiwiSlNPTiIsInBhcnNlIiwidmFsaWRCZWxpZWZzIiwiY29uc29sZSIsIndhcm4iLCJlcnJv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