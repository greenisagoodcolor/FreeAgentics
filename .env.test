# FreeAgentics Test Environment Configuration
#
# Automatically loaded by pytest for complete test isolation.
# This configuration ensures tests run in a predictable, isolated environment
# with no external dependencies or persistent state.

# =============================================================================
# CORE TEST ENVIRONMENT
# =============================================================================

# Environment type - forces test mode behaviors
ENVIRONMENT=test

# Enable verbose test logging for debugging
DEBUG=true
LOG_LEVEL=DEBUG
LOG_FORMAT=json

# Test mode flag - enables test-specific behaviors
DEVELOPMENT_MODE=true
TESTING=true

# =============================================================================
# DATABASE CONFIGURATION - IN-MEMORY ONLY
# =============================================================================

# Force in-memory SQLite for complete test isolation
DATABASE_URL=sqlite:///:memory:
SQLITE_FILE=:memory:

# Minimal database pool settings for tests
DB_POOL_SIZE=5
DB_POOL_OVERFLOW=5
DB_POOL_TIMEOUT=5
DB_POOL_PRE_PING=false

# Disable PostgreSQL settings in test environment
POSTGRES_USER=
POSTGRES_PASSWORD=
POSTGRES_DB=
POSTGRES_HOST=
POSTGRES_PORT=

# =============================================================================
# LLM PROVIDER - MOCK ONLY
# =============================================================================

# Force mock LLM provider for deterministic test responses
LLM_PROVIDER=mock
OPENAI_API_KEY=
ANTHROPIC_API_KEY=

# Test-optimized LLM settings
OPENAI_MODEL=mock-gpt-3.5-turbo
OPENAI_TEMPERATURE=0.0
OPENAI_MAX_TOKENS=100
OPENAI_TIMEOUT=5

# Deterministic embedding settings for tests
LLM_EMBED_MODEL=mock-embedding
LLM_EMBED_DIM=384

# =============================================================================
# AGENT CONFIGURATION - MINIMAL FOR TESTS
# =============================================================================

# Simplified agent parameters for fast test execution
AGENT_EXPLORATION_RATE=0.0
AGENT_REASONING_DEPTH=1
AGENT_LLM_TEMPERATURE=0.0
AGENT_INFERENCE_TIMEOUT=5

# Minimal agent limits
MAX_AGENTS_PER_USER=2
AGENT_MEMORY_LIMIT_MB=10
AGENT_MAX_CONVERSATION_HISTORY=10

# Minimal grid world for tests
GRID_SIZE=5
GRID_H3_RESOLUTION=3
GRID_UPDATE_INTERVAL_MS=100

# =============================================================================
# CACHING - IN-MEMORY ONLY
# =============================================================================

# No Redis in test environment - use in-memory caching
REDIS_URL=
REDIS_HOST=
REDIS_PORT=
REDIS_DB=
REDIS_PASSWORD=

# Short cache TTL for tests
CACHE_TTL_DEFAULT=60
CACHE_TTL_AGENTS=60
CACHE_TTL_KNOWLEDGE_GRAPH=60

# =============================================================================
# AUTHENTICATION - TEST MODE
# =============================================================================

# Fixed test secrets (safe for testing only)
SECRET_KEY=test-secret-key-not-for-production
JWT_SECRET_KEY=test-jwt-secret-not-for-production
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=60
JWT_REFRESH_TOKEN_EXPIRE_DAYS=1

# Enable dev auth bypass for tests
DEV_AUTH_ENABLED=true
DEV_AUTH_USERNAME=test_user
DEV_AUTH_PASSWORD=test_password

# Permissive CORS for tests
ALLOWED_HOSTS=localhost,127.0.0.1,testserver
CORS_ORIGINS=["http://localhost:3000", "http://testserver"]

# =============================================================================
# API AND NETWORKING - TEST CONFIGURATION
# =============================================================================

# Test server configuration
API_HOST=127.0.0.1
API_PORT=8000
API_PREFIX=/api/v1

# Test frontend configuration  
FRONTEND_HOST=localhost
FRONTEND_PORT=3000

# Test WebSocket configuration - use demo endpoint
WS_ENDPOINT=/api/v1/ws/test
WS_HOST=127.0.0.1
WS_PORT=8000

# Force demo WebSocket for tests (no auth required)
NEXT_PUBLIC_WS_URL=
WS_AUTH_REQUIRED=false

# Fast WebSocket settings for tests
WS_PING_INTERVAL=5
WS_PING_TIMEOUT=10
WS_MAX_CONNECTIONS=10

# Test API URLs
NEXT_PUBLIC_API_URL=http://testserver
BACKEND_URL=http://testserver

# =============================================================================
# SECURITY - DISABLED FOR TESTS
# =============================================================================

# Disable production security features
PRODUCTION=false
SECURE_COOKIES=false
HTTPS_ONLY=false
SECURITY_HEADERS_ENABLED=false

# Disable rate limiting for tests
RATE_LIMITING_ENABLED=false
RATE_LIMIT_REQUESTS_PER_MINUTE=1000

# Disable CSRF for tests
CSRF_ENABLED=false

# No SSL in test environment
SSL_ENABLED=false
SSL_CERT_PATH=
SSL_KEY_PATH=

# =============================================================================
# OBSERVABILITY - TEST-OPTIMIZED
# =============================================================================

# Enable metrics but disable external reporting
METRICS_ENABLED=true
METRICS_PORT=8001
PROMETHEUS_ENDPOINT=

# Test telemetry configuration
OTEL_SERVICE_NAME=freeagentics-test
OTEL_SERVICE_VERSION=test
OTEL_EXPORTER_OTLP_ENDPOINT=
OTEL_RESOURCE_ATTRIBUTES=environment=test

# Disable performance monitoring overhead
ENABLE_PERFORMANCE_MONITORING=false
PERFORMANCE_SAMPLING_RATE=0.0

# No external error tracking in tests
SENTRY_DSN=
SENTRY_ENVIRONMENT=test

# =============================================================================
# FEATURE FLAGS - TEST DEFAULTS
# =============================================================================

# Disable expensive features for tests
ENABLE_REAL_LLM_CALLS=false
ENABLE_AGENT_COMMUNICATION=true
ENABLE_KNOWLEDGE_GRAPH_UPDATES=false
ENABLE_WEBSOCKET_REALTIME=true

# Disable advanced features
ENABLE_PGVECTOR_SIMILARITY=false
ENABLE_DISTRIBUTED_TRACING=false
ENABLE_CIRCUIT_BREAKER=false

# Enable test development features
ENABLE_API_DOCS=true
ENABLE_DEV_ENDPOINTS=true
ENABLE_MOCK_DATA=true

# =============================================================================
# TESTING SPECIFIC CONFIGURATION
# =============================================================================

# Test database for pytest
TEST_DATABASE_URL=sqlite:///:memory:
PYTEST_TIMEOUT=30

# Coverage settings
COVERAGE_PERCENT=80
COVERAGE_FAIL_UNDER=70

# Disable development tools that slow down tests
ENABLE_HOT_RELOAD=false
ENABLE_DEBUG_TOOLBAR=false

# Disable load testing in regular test runs
LOAD_TEST_ENABLED=false
LOAD_TEST_CONCURRENT_USERS=1
LOAD_TEST_DURATION=1

# =============================================================================
# LOGGING - ENHANCED FOR TEST DEBUGGING
# =============================================================================

# Detailed logging for test debugging
ENABLE_SQL_LOGGING=false
ENABLE_REQUEST_LOGGING=false
ENABLE_WEBSOCKET_LOGGING=false

# Minimal profiling
ENABLE_PROFILING=false
PROFILING_SAMPLE_RATE=0.0

# =============================================================================
# EXTERNAL SERVICES - ALL DISABLED
# =============================================================================

# No external services in test environment
EMAIL_HOST=
EMAIL_PORT=
EMAIL_USER=
EMAIL_PASSWORD=
EMAIL_USE_TLS=false

# Local file storage only
FILE_STORAGE_BACKEND=local
FILE_STORAGE_PATH=/tmp/freeagentics-test-uploads
AWS_S3_BUCKET=
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=

# No third-party integrations
WEBHOOK_SECRET=
SLACK_BOT_TOKEN=
DISCORD_BOT_TOKEN=

# =============================================================================
# MEMORY OPTIMIZATION - MINIMAL FOR TESTS
# =============================================================================

# Disable memory optimizations that add complexity
AGENT_MEMORY_OPTIMIZATION_ENABLED=false
BELIEF_COMPRESSION_ENABLED=false
MATRIX_POOLING_ENABLED=false

# Minimal threading for deterministic tests
THREADING_POOL_SIZE=1
ASYNC_POOL_SIZE=2

# Fast retry settings for tests
RETRY_ATTEMPTS=1
RETRY_BACKOFF_MS=100
TIMEOUT_MS=5000

# Fast database migrations
AUTO_MIGRATE=true
MIGRATION_TIMEOUT=10

# =============================================================================
# KNOWLEDGE GRAPH - MINIMAL FOR TESTS
# =============================================================================

# Reduced knowledge graph settings for tests
KNOWLEDGE_GRAPH_MAX_NODES=50
KNOWLEDGE_GRAPH_UPDATE_INTERVAL=1000

# Disable vector storage in tests
ENABLE_PGVECTOR=false
VECTOR_DIMENSION=384

# Minimal H3 spatial indexing
ENABLE_H3_SPATIAL_INDEXING=false
H3_DEFAULT_RESOLUTION=3
